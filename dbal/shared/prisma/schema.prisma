datasource db {
  provider = "sqlite"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id String @id
  username String @unique
  email String @unique
  role String
  profilePicture String?
  bio String?
  createdAt BigInt
  tenantId String?
  isInstanceOwner Boolean @default(false)
  passwordChangeTimestamp BigInt?
  firstLogin Boolean @default(false)
  @@index([tenantId])
  @@index([role])
}

model Credential {
  username String @id
  passwordHash String
}

model Session {
  id String @id
  userId String
  token String @unique
  expiresAt BigInt
  createdAt BigInt
  lastActivity BigInt
  ipAddress String?
  userAgent String?
  @@index([userId])
  @@index([expiresAt])
  @@index([token])
}

model PageConfig {
  id String @id
  tenantId String?
  packageId String?
  path String // Route pattern: /media/jobs, /forum/:id
  title String
  description String?
  icon String?
  component String?
  componentTree String // JSON: full component tree
  level Int
  requiresAuth Boolean
  requiredRole String?
  parentPath String?
  sortOrder Int @default(0)
  isPublished Boolean @default(true)
  params String?
  meta String?
  createdAt BigInt?
  updatedAt BigInt?
  @@unique([tenantId, path])
  @@index([tenantId])
  @@index([packageId])
  @@index([level])
  @@index([parentPath])
}

model ComponentNode {
  id String @id
  type String
  parentId String?
  childIds String // JSON: string[]
  order Int
  pageId String
  @@index([pageId])
  @@index([parentId])
}

model ComponentConfig {
  id String @id
  componentId String
  props String // JSON
  styles String // JSON
  events String // JSON
  conditionalRendering String?
  @@index([componentId])
}

model Workflow {
  id String @id
  tenantId String?
  name String
  description String?
  nodes String // JSON: WorkflowNode[]
  edges String // JSON: WorkflowEdge[]
  enabled Boolean
  version Int @default(1)
  createdAt BigInt?
  updatedAt BigInt?
  createdBy String?
  @@index([tenantId])
  @@index([enabled])
}

model InstalledPackage {
  packageId String @id
  tenantId String?
  installedAt BigInt
  version String
  enabled Boolean
  config String?
  @@index([tenantId])
}

model PackageData {
  packageId String @id
  data String // JSON
}

model ComponentNode {
  id String? @id
  pageId String
  parentId String?
  type String
  childIds String
  order String @default(0)
  @@index([pageId])
  @@index([parentId])
  @@index([pageId, order])
}

model Credential {
  username String? @id
  passwordHash String
  @@index([username])
}

model PageConfig {
  id String? @id
  tenantId String?
  packageId String?
  path String
  title String
  description String?
  icon String?
  component String?
  componentTree String
  level String
  requiresAuth Boolean
  requiredRole String?
  parentPath String?
  sortOrder String @default(0)
  isPublished Boolean @default(true)
  params String?
  meta String?
  createdAt BigInt?
  updatedAt BigInt?
  @@index([path])
  @@index([level])
  @@index([isPublished])
}

model InstalledPackage {
  packageId String? @id
  tenantId String?
  installedAt BigInt
  version String
  enabled Boolean
  config String?
  @@index([tenantId])
}

model Session {
  id String? @id
  userId String
  token String @unique
  expiresAt BigInt
  createdAt BigInt?
  lastActivity BigInt
  ipAddress String?
  userAgent String?
  @@index([token])
  @@index([userId])
  @@index([expiresAt])
}

model UIPage {
  id String? @id
  path String
  title String
  level String
  requireAuth Boolean @default(false)
  requiredRole String?
  layout String
  actions String?
  packageId String?
  isActive Boolean @default(true)
  createdAt BigInt?
  updatedAt BigInt?
  createdBy String?
  @@index([path])
  @@index([level, isActive])
  @@index([packageId])
}

model User {
  id String? @id
  username String @unique
  email String @unique
  role String @default("user")
  profilePicture String?
  bio String?
  createdAt BigInt?
  tenantId String?
  isInstanceOwner Boolean @default(false)
  passwordChangeTimestamp BigInt?
  firstLogin Boolean @default(false)
  @@index([username])
  @@index([email])
  @@index([role])
  @@index([tenantId])
}

model AuditLog {
  id String? @id @default(cuid())
  tenantId String
  userId String?
  username String?
  action String
  entity String
  entityId String?
  oldValue String?
  newValue String?
  ipAddress String?
  userAgent String?
  details String?
  timestamp BigInt
  @@index([tenantId, timestamp])
  @@index([entity, entityId])
  @@index([tenantId, userId])
}

model EmailAttachment {
  id String? @id @default(cuid())
  tenantId String
  messageId String
  filename String
  mimeType String
  size BigInt
  contentId String?
  isInline Boolean? @default(false)
  storageKey String @unique
  downloadUrl String?
  createdAt BigInt?
  @@index([messageId])
  @@index([tenantId, messageId])
}

model EmailClient {
  id String? @id @default(cuid())
  tenantId String
  userId String
  accountName String
  emailAddress String @unique
  protocol String? @default("imap")
  hostname String
  port Int
  encryption String? @default("tls")
  username String
  credentialId String
  isSyncEnabled Boolean? @default(true)
  syncInterval Int? @default(300)
  lastSyncAt BigInt?
  isSyncing Boolean? @default(false)
  isEnabled Boolean? @default(true)
  createdAt BigInt?
  updatedAt BigInt?
  @@index([userId, tenantId])
  @@index([emailAddress, tenantId])
}

model EmailFolder {
  id String? @id @default(cuid())
  tenantId String
  emailClientId String
  name String
  type String? @default("custom")
  unreadCount Int? @default(0)
  totalCount Int? @default(0)
  syncToken String?
  isSelectable Boolean? @default(true)
  createdAt BigInt?
  updatedAt BigInt?
  @@index([emailClientId, name])
  @@index([tenantId, emailClientId, type])
}

model EmailMessage {
  id String? @id @default(cuid())
  tenantId String
  emailClientId String
  folderId String
  messageId String
  imapUid String?
  from String
  to String
  cc String?
  bcc String?
  replyTo String?
  subject String?
  textBody String?
  htmlBody String?
  headers String?
  receivedAt BigInt
  isRead Boolean? @default(false)
  isStarred Boolean? @default(false)
  isSpam Boolean? @default(false)
  isDraft Boolean? @default(false)
  isSent Boolean? @default(false)
  isDeleted Boolean? @default(false)
  attachmentCount Int? @default(0)
  conversationId String?
  labels String?
  size BigInt?
  createdAt BigInt?
  updatedAt BigInt?
  @@index([emailClientId, folderId, receivedAt])
  @@index([tenantId, isRead, receivedAt])
  @@index([conversationId])
}

model Notification {
  id String? @id @default(cuid())
  tenantId String
  userId String
  type String
  title String
  message String
  icon String?
  read Boolean? @default(false)
  data String?
  createdAt BigInt
  expiresAt BigInt?
  @@index([userId, read])
  @@index([tenantId, createdAt])
}

model Video {
  id String
  tenantId String
  title String
  description String?
  uploaderId String
  videoUrl String
  thumbnailUrl String?
  duration String
  category String?
  tags String?
  views String @default(0)
  likes String @default(0)
  dislikes String @default(0)
  published String @default(false)
  unlisted String? @default(false)
  status String @default("draft")
  createdAt String
  updatedAt String?
  publishedAt String?
  @@index([tenantId, publishedAt])
  @@index([uploaderId, tenantId])
  @@index([tenantId, status])
  @@index([createdAt, tenantId])
}
