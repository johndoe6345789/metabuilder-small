entity: AuditLog
version: "1.0"
description: "Audit log entry for tracking user and system actions"
package: audit_log

fields:
  id:
    type: cuid
    primary: true
    generated: true
    description: "Unique audit log identifier"
    
  tenantId:
    type: string
    required: true
    index: true
    description: "Tenant this log belongs to"
    
  userId:
    type: uuid
    nullable: true
    index: true
    description: "User who performed the action"
    
  username:
    type: string
    nullable: true
    description: "Username snapshot at time of action"
    
  action:
    type: enum
    required: true
    values: [create, update, delete, login, logout, access, execute, export, import]
    index: true
    description: "Type of action performed"
    
  entity:
    type: string
    required: true
    max_length: 100
    description: "Entity type affected (User, Workflow, Page, etc.)"
    
  entityId:
    type: string
    nullable: true
    description: "ID of the affected entity"
    
  oldValue:
    type: json
    nullable: true
    description: "Previous state of the entity"
    
  newValue:
    type: json
    nullable: true
    description: "New state of the entity"
    
  ipAddress:
    type: string
    nullable: true
    max_length: 45
    description: "Client IP address"
    
  userAgent:
    type: string
    nullable: true
    description: "Client user agent string"
    
  details:
    type: json
    nullable: true
    description: "Additional context as JSON"
    
  timestamp:
    type: bigint
    required: true
    index: true
    description: "Unix timestamp in milliseconds"

indexes:
  - fields: [tenantId, timestamp]
    name: tenant_time
  - fields: [entity, entityId]
    name: entity_lookup
  - fields: [tenantId, userId]
    name: tenant_user

relations:
  user:
    type: belongs-to
    entity: User
    foreign_key: userId
    nullable: true
    on_delete: set_null
    description: "User who performed the action (null for system actions)"

acl:
  create:
    admin: true
    system: true
  read:
    admin: true
    god: true
  update:
    supergod: true
  delete:
    supergod: true
