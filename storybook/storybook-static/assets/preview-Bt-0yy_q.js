import{j as l}from"./jsx-runtime-u17CrQMm.js";import{r as d}from"./index-Bi6L2ga8.js";import{a as $}from"./packageDiscovery-Bw1mld_3.js";class m{schema;cssVariables=new Map;constructor(e){this.schema=e,this.extractTokens()}extractTokens(){if(this.schema.tokens&&(this.schema.tokens.colors&&Object.entries(this.schema.tokens.colors).forEach(([e,r])=>{this.cssVariables.set(`--color-${e}`,r.value)}),this.schema.tokens.spacing?.unit)){const{number:e,unit:r}=this.schema.tokens.spacing.unit.value;this.cssVariables.set("--spacing-unit",`${e}${r}`)}}buildSelector(e){const r=this.schema.selectors?.find(c=>c.id===e);if(!r)return"";const{predicate:t}=r;let o="";const s={Text:".text",Button:".button",Card:".card",Box:".box",Input:".input",Table:".table",TableRow:".table-row",Nav:".nav",Section:".section"};s[t.targetType]||`${t.targetType.toLowerCase()}`;const i=this.schema.package||"",a=t.classes.map(c=>c.startsWith(i+"_")?`.${c}`:`.${i}_${c}`).join(""),h=t.states.map(c=>`:${c}`).join("");if(o=`${a}${h}`,t.relationship){const c=s[t.relationship.ancestor.targetType]||`.${t.relationship.ancestor.targetType.toLowerCase()}`,u=t.relationship.ancestor.classes.map(p=>p.startsWith(i+"_")?`.${p}`:`.${i}_${p}`).join("");t.relationship.type==="descendant"?o=`${c}${u} ${o}`:t.relationship.type==="child"&&(o=`${c}${u} > ${o}`)}return o}compileEffectProperties(e){const r=this.schema.effects?.find(o=>o.id===e);if(!r)return"";const t=[];return Object.entries(r.properties).forEach(([o,s])=>{const i=this.convertPropertyName(o),a=this.convertPropertyValue(s);a&&t.push(`  ${i}: ${a};`)}),t.join(`
`)}convertPropertyName(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}convertPropertyValue(e){if(!e)return"";if(e.token)return`var(--color-${e.token})`;if(e.value!==void 0&&e.unit)return`${e.value}${e.unit}`;if(typeof e=="number")return e.toString();if(typeof e=="string")return e;if(e.type==="responsive"&&e.breakpoints){const r=Object.keys(e.breakpoints).sort().reverse(),t=e.breakpoints[r[0]];return`${t.value}${t.unit}`}if(e.type==="transform"){const r=[];return e.value.translateY&&r.push(`translateY(${e.value.translateY.value}${e.value.translateY.unit})`),e.value.translateX&&r.push(`translateX(${e.value.translateX.value}${e.value.translateX.unit})`),e.value.scale&&r.push(`scale(${e.value.scale})`),e.value.rotate&&r.push(`rotate(${e.value.rotate.value}${e.value.rotate.unit||"deg"})`),r.join(" ")}return""}compileAppearance(e){const r=this.schema.appearance?.find(s=>s.id===e);if(!r)return"";const t=[];return[...r.layers].sort((s,i)=>(s.order||0)-(i.order||0)).forEach(s=>{if(s.type==="background"&&s.properties.gradient){const i=this.compileGradient(s.properties.gradient);t.push(`  background: ${i};`)}if(s.type==="border"&&s.properties){if(s.properties.width&&t.push(`  border-width: ${s.properties.width.value}${s.properties.width.unit};`),s.properties.style&&t.push(`  border-style: ${s.properties.style};`),s.properties.color){const i=s.properties.color.token?`var(--color-${s.properties.color.token})`:s.properties.color;t.push(`  border-color: ${i};`)}s.properties.radius&&t.push(`  border-radius: ${s.properties.radius.value}${s.properties.radius.unit};`)}if(s.type==="shadow"&&s.properties){const i=[s.properties.offsetX?`${s.properties.offsetX.value}${s.properties.offsetX.unit}`:"0",s.properties.offsetY?`${s.properties.offsetY.value}${s.properties.offsetY.unit}`:"0",s.properties.blur?`${s.properties.blur.value}${s.properties.blur.unit}`:"0",s.properties.spread?`${s.properties.spread.value}${s.properties.spread.unit}`:"0",s.properties.color?.value||"rgba(0,0,0,0.1)"].join(" ");t.push(`  box-shadow: ${i};`)}if(s.type==="foreground"&&s.properties.color){const i=s.properties.color.value?.token?`var(--color-${s.properties.color.value.token})`:s.properties.color.value;t.push(`  color: ${i};`)}}),r.clip==="text"&&(t.push("  background-clip: text;"),t.push("  -webkit-background-clip: text;"),t.push("  -webkit-text-fill-color: transparent;"),t.push("  color: transparent;")),t.join(`
`)}compileGradient(e){const{type:r,angle:t,stops:o}=e,s=o.map(i=>`${i.color.token?`var(--color-${i.color.token})`:i.color.value} ${i.position*100}%`);return r==="linear"?`linear-gradient(${t}deg, ${s.join(", ")})`:""}compileTransition(e){const r=this.schema.transitions?.find(i=>i.id===e);if(!r)return"";const t=r.properties.map(i=>this.convertPropertyName(i)).join(", "),o=`${r.duration.value}${r.duration.unit}`,s=r.easing;return`  transition: ${t} ${o} ${s};`}compile(){const e=[];return this.cssVariables.size>0&&(e.push(":root {"),this.cssVariables.forEach((t,o)=>{e.push(`  ${o}: ${t};`)}),e.push("}"),e.push("")),[...this.schema.rules||[]].sort((t,o)=>t.priority.sourceOrder-o.priority.sourceOrder).forEach(t=>{if(!t.enabled)return;const o=this.buildSelector(t.selector);if(o){if(e.push(`${o} {`),t.effects){const s=this.compileEffectProperties(t.effects.ref);s&&e.push(s)}if(t.appearance){const s=this.compileAppearance(t.appearance.ref);s&&e.push(s)}if(t.transition){const s=this.compileTransition(t.transition.ref);s&&e.push(s)}e.push("}"),e.push("")}}),this.compileResponsive(e),e.join(`
`)}compileResponsive(e){this.schema.environments?.forEach(r=>{if(!r.conditions.viewport)return;const t=[];if(r.conditions.viewport.minWidth){const{value:o,unit:s}=r.conditions.viewport.minWidth;t.push(`min-width: ${o}${s}`)}if(r.conditions.viewport.maxWidth){const{value:o,unit:s}=r.conditions.viewport.maxWidth;t.push(`max-width: ${o}${s}`)}t.length>0&&(e.push(`@media (${t.join(" and ")}) {`),e.push("}"),e.push(""))})}}function g(n){return new m(n).compile()}async function b(n){try{const r=await(await fetch(`/packages/${n}/seed/styles.json`)).json();return r.schema_version||r.package?g(r):r.map(t=>t.css||"").join(`

`)}catch(e){return console.error(`Failed to load styles for package ${n}:`,e),""}}function v(n,e){const r=`styles-${n}`;let t=document.getElementById(r);t||(t=document.createElement("style"),t.id=r,t.dataset.package=n,document.head.appendChild(t)),t.textContent=e}async function f(n){const e=await b(n);return v(n,e),e}typeof window<"u"&&$().then(n=>(console.log(`ðŸ“¦ Discovered ${n.length} packages with styles:`,n),Promise.all(n.map(async e=>{try{const r=await f(e);return console.log(`âœ“ ${e} (${r.length} bytes)`),{packageId:e,success:!0,size:r.length}}catch(r){return console.warn(`âœ— ${e}:`,r),{packageId:e,success:!1,size:0}}})))).then(n=>{const e=n.filter(t=>t.success),r=e.reduce((t,o)=>t+o.size,0);console.log(`âœ… ${e.length} packages loaded (${(r/1024).toFixed(1)}KB)`)}).catch(n=>{console.error("âŒ Discovery failed:",n)});const x={parameters:{controls:{matchers:{color:/(background|color)$/i,date:/Date$/i}},backgrounds:{default:"light",values:[{name:"light",value:"#ffffff"},{name:"dark",value:"#1a1a2e"},{name:"canvas",value:"#f5f5f5"}]}},decorators:[n=>(d.useEffect(()=>{const e=n?.parameters?.package;e&&(document.getElementById(`styles-${e}`)||f(e).then(t=>{console.log(`âœ“ Story-specific: ${e} (${t.length} bytes)`)}).catch(t=>{console.warn(`âœ— Story-specific ${e}:`,t)}))},[]),l.jsx("div",{style:{padding:"1rem"},children:l.jsx(n,{})}))]};export{x as default};
